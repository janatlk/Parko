# Frontend Tasks
Система учёта автопарка предприятий (SaaS)

Файл описывает **только frontend‑задачи** (React + Vite + TypeScript), ориентированные на использование существующего Django + DRF backend. Все задачи предполагают работу с REST API (`/api/v1/`), JWT‑аутентификацию и ролевую модель.

Нумерация задач: `FE-XXX` – основная задача, `FE-XXX.X` – подзадача.

---

## 0. Общие принципы и архитектура

### FE-000. Общие технические решения frontend

- [ ] **FE-000.1** Определить целевой стек:
  - React 18 + Vite.
  - TypeScript.
  - React Router (маршрутизация).
  - TanStack Query (React Query) для работы с серверным состоянием.
  - Axios для HTTP‑запросов с интерсепторами.
  - UI‑библиотека (например, MUI или Mantine) + иконки (Lucide/Tabler).
  - i18n (например, `react-i18next`).
- [ ] **FE-000.2** Принять структуру проекта по модулям:
  - `app/` – корневой layout, роутинг, провайдеры (QueryClientProvider, i18n, AuthProvider и т.п.).
  - `shared/` – общие компоненты (кнопки, таблицы, модалки, формы, лоадеры).
  - `features/` – фичи (auth, users, companies, cars, fuel, reports и т.д.).
  - `entities/` – сущности домена (User, Company, Car и т.п. – типы, хелперы, мапперы).
  - `widgets/` – составные блоки интерфейса (хедер, сайдбар, карточка машины и т.п.).
  - `pages/` – страницы (LoginPage, DashboardPage, CarsPage и т.д.).
  - `shared/api/` – настройка axios, обёртки для запросов.
- [ ] **FE-000.3** Определить общие UX‑принципы:
  - Единый layout: сайдбар + topbar + контент.
  - Обработка загрузки (skeleton/spinner) и ошибок (toast/alert) по единому паттерну.
  - Отображение недоступных действий для ролей: кнопки серые, курсор `not-allowed`, tooltip с пояснением.

---

## 1. Инициализация проекта и базовая инфраструктура

### FE-010. Создание и базовая настройка проекта

- [ ] **FE-010.1** Инициализировать проект на основе Vite + React + TypeScript.
  - Настроить alias’ы путей (`@app`, `@features`, `@entities`, `@shared` и т.д.).
- [ ] **FE-010.2** Подключить и настроить UI‑библиотеку.
  - Базовая тема (цвета, шрифты), тёмный/светлый режим на будущее.
- [ ] **FE-010.3** Настроить ESLint + Prettier.
  - Базовые правила для TS/React.

### FE-011. HTTP‑клиент и работа с API

- [ ] **FE-011.1** Настроить axios‑инстанс:
  - Базовый URL (`/api/v1/`).
  - Интерсептор для добавления JWT access‑токена в заголовок Authorization.
  - Интерсептор для обработки 401/403 и автоматического logout/refresh (когда backend будет готов).
- [ ] **FE-011.2** Интегрировать TanStack Query:
  - Создать `QueryClient` и обернуть приложение в `QueryClientProvider`.
  - Определить базовые настройки (retries, staleTime и т.п.).

---

## 2. Аутентификация, роли и контекст компании

### FE-020. Модели данных и типы (Auth, User, Company)

- [ ] **FE-020.1** Описать TypeScript‑типы для основных сущностей:
  - `User`, `Company`, `Car`, `FuelRecord`, `Insurance`, `Inspection`, `Tire`, `Accumulator` и т.п. (на основе backend‑схем и планируемого OpenAPI).
- [ ] **FE-020.2** Описать enum’ы/константы для ролей и языков:
  - Роли: `COMPANY_ADMIN`, `DISPATCHER`, `MECHANIC`, `DRIVER`, `ACCOUNTANT`, `GUEST`.
  - Языки: `ru`, `en`, `ky`.

### FE-021. Контекст аутентификации и текущего пользователя

- [ ] **FE-021.1** Реализовать `AuthProvider`:
  - Хранение access/refresh токенов (localStorage или sessionStorage – в соответствии с решениями backend).
  - Хранение объекта текущего пользователя (`/api/v1/auth/me/` – когда backend будет готов).
  - Методы: `login`, `logout`, `refresh`, `setUser`.
- [ ] **FE-021.2** Создать хуки:
  - `useAuth()` – доступ к текущему пользователю и методам auth.
  - `useRequireAuth()` – редирект на логин, если пользователь не авторизован.

### FE-022. Роли и доступы на фронте

- [ ] **FE-022.1** Реализовать утилиты для проверки ролей:
  - `canEditUsers(user)`, `canEditCars(user)`, `canViewReports(user)` и т.п.
- [ ] **FE-022.2** Реализовать HOC/компонент ограничения доступа:
  - `PermissionGuard` – управляет доступом к компонентам по роли.
  - Для недоступных действий – рендерит disabled‑кнопку, курсор `not-allowed`, tooltip «Недоступно для вашей роли».

---

## 3. Маршрутизация и базовый layout

### FE-030. Маршрутизатор и базовые страницы

- [ ] **FE-030.1** Настроить React Router:
  - Публичный роут `/login`.
  - Приватные роуты `/dashboard`, `/cars`, `/users`, `/reports` и т.п.
- [ ] **FE-030.2** Реализовать компонент `ProtectedRoute`:
  - Проверяет авторизацию через `useAuth()`.
  - Неавторизованных перекидывает на `/login`.

### FE-031. Общий layout

- [ ] **FE-031.1** Реализовать основной layout:
  - Сайдбар с навигацией (Dashboard, Машины, Пользователи, Отчёты).
  - Верхняя панель (профиль пользователя, язык, возможно выбор компании).
- [ ] **FE-031.2** Адаптивность:
  - Минимальная адаптация под ноутбуки/планшеты (бургер‑меню для сайдбара).

---

## 4. Экран аутентификации

### FE-040. Страница логина

- [ ] **FE-040.1** Реализовать `LoginPage`:
  - Форма логина (email/username + пароль – в зависимости от backend‑контракта).
  - Валидация полей, отображение ошибок backend.
- [ ] **FE-040.2** Интеграция с API:
  - Вызов `POST /api/v1/auth/login/`.
  - Сохранение токенов, загрузка профиля текущего пользователя.
  - Редирект на `/dashboard` после успешного логина.

---

## 5. Страницы компании, пользователей и ролей

### FE-050. Управление пользователями компании

- [ ] **FE-050.1** Страница списка пользователей (`/users`):
  - Таблица пользователей компании с фильтрацией по роли/статусу.
  - Отображение роли, языка, состояния (активен/деактивирован).
- [ ] **FE-050.2** Формы создания/редактирования пользователя:
  - Модальное окно/отдельная страница для создания/редактирования.
  - Выбор роли, языка, опционально региона.
  - Управление активностью пользователя.
- [ ] **FE-050.3** Учет ролей:
  - Для не‑админов кнопки создания/редактирования неактивны (серые, `not-allowed`).

### FE-051. Профиль текущего пользователя

- [ ] **FE-051.1** Страница/панель профиля:
  - Просмотр имени, email, роли, компании.
  - Изменение языка интерфейса, при возможности – других доступных полей.

---

## 6. Машины (Fleet) – базовый функционал

### FE-060. Список машин

- [ ] **FE-060.1** Страница списка машин (`/cars`):
  - Таблица машин с ключевыми полями: номер, марка, водитель, статус, регион.
  - Фильтры по региону, типу, бренду, номеру, статусу.
- [ ] **FE-060.2** Детальная страница машины:
  - Вкладки: Общая информация, ТО/запчасти, Топливо, Страховки, Техосмотры, Шины, Аккумуляторы, Фотографии.

### FE-061. CRUD‑операции по машинам

- [ ] **FE-061.1** Форма создания/редактирования машины:
  - Поля, согласованные с backend‑моделью `Car`.
- [ ] **FE-061.2** Ограничение по ролям:
  - Создание/редактирование доступны только ролям admin/dispatcher.
  - Остальные видят данные только в режиме просмотра.

---

## 7. Отчёты и аналитика (после базового MVP)

### FE-070. Общий экран отчётов

- [ ] **FE-070.1** Страница `/reports`:
  - Выбор типа отчёта: по топливу, затратам на ТО, страховкам/техосмотрам.
  - Параметры фильтрации: диапазон дат, машина, компания (если релевантно).

### FE-071. Визуализация

- [ ] **FE-071.1** Подключить библиотеку графиков (Recharts/Chart.js или аналог).
  - Графики по расходу топлива, затратам, статусам страховок.

---

## 8. Интернационализация (i18n)

### FE-080. Базовая i18n‑инфраструктура

- [ ] **FE-080.1** Подключить `react-i18next`:
  - Настроить языки: RU (по умолчанию), EN, KY.
  - Организовать структуру переводов по неймспейсам (common, auth, users, cars и т.д.).
- [ ] **FE-080.2** Переводы ключевых экранов:
  - Login, Dashboard, Users, Cars.

---

## 9. Связь с backend и контрактами API

### FE-090. Согласование DTO и OpenAPI

- [ ] **FE-090.1** При появлении OpenAPI‑схемы:
  - Сгенерировать/обновить TS‑типы на основе схемы (через `openapi-typescript` или аналог).
  - Проверить соответствие фронтовых типов и реальных ответов API.
- [ ] **FE-090.2** Согласовать поля и структуры с backend:
  - Убедиться, что названия полей и фильтров в запросах соответствуют backend.

---

## 10. Технический долг и улучшения

### FE-100. Улучшения после MVP

- [ ] **FE-100.1** Добавить более тонкую систему прав на уровне фронта.
- [ ] **FE-100.2** Оптимизировать запросы (кэширование, prefetch, background refresh в React Query).
- [ ] **FE-100.3** Наладить e2e‑тесты для ключевых сценариев (логин, просмотр списка машин, создание пользователя).
